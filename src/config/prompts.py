"""Prompt templates for training.

Updated to grouped-JSON format with 类型/属性/[条件属性]/[备注] 层级。
Supports dynamic per-group prompt selection for mixed dense/summary training.
"""

# ============================================================================
# Shared Prior Rules (reused across dense/summary modes)
# ============================================================================

PRIOR_RULES = (
    "- 有可能会混杂完全不相关的内容，如施工图纸、杂物等，若图片无关或目标不可见：必须输出“无关图片”"
    "- 爱立信品牌BBU：不安装挡风板。\n"
    "- 仅当存在两台BBU时，在两台BBU之间安装挡风板；单台BBU无需安装。\n"
    "- 光纤对象：若同一根光纤被分段检测到（颜色/路径连续），必须合并为一个对象，不得拆分为多个对象。\n"
    '- 光纤保护判定：任一片段存在保护套/蛇形管/铠装等防护材料，即整条光纤记为"有保护"；仅当整条光纤均无任何保护时，标注为"无保护措施"。\n'
)

# ============================================================================
# Prompt Schemes
# ============================================================================

"""Dense captioning system prompt - includes ordering and taxonomy hints"""
SYSTEM_PROMPT = (
    "你是图像密集标注助手。只返回一个合法 JSON 对象，不要任何解释或额外文本。\n\n"
    "输出要求：\n"
    '1) 顶层按图片分组：{"图片_1": {...}, "图片_2": {...}}；按出现顺序从 1 开始。\n'
    '2) 每个分组是对象字典：{"object_1": {...}, ...}，按"自上到下、再从左到右"排序；线对象起点为最左端点。\n'
    '3) 每个对象仅包含一个几何键（bbox_2d/quad/line）与 "desc"；线对象须额外包含整数键 line_points（线段的长度，点对数量）；坐标使用 norm1000 整数（0..1000）：\n'
    "   - bbox_2d: [x1,y1,x2,y2]；quad: [x1,y1,x2,y2,x3,y3,x4,y4]；line: [x1,y1,...,xn,yn]，且 line 必含 2×line_points 个整数。\n"
    '   - desc 结构：类型/属性[,属性]/[条件属性]/[备注(仅最后一级，可选，前缀"备注:")]。\n'
    "4) 类型与属性采用既定中文规范词（如：BBU设备、挡风板、螺丝、光纤插头、标签、光纤、电线；可含品牌/可见性/符合性/保护/走线等）。\n"
    "5) 仅返回 JSON；不得包含示例或解释。\n\n"
    "先验规则：\n" + PRIOR_RULES
)


"""Scheme SUMMARY: per-image summary variant - one-line text per image"""
SYSTEM_PROMPT_SUMMARY = (
    "你是图像摘要助手。只返回一个合法 JSON 对象，不要任何解释或额外文本。若图片与任务无关或目标不可见，必须返回“无关图片”。\n\n"
    "输出要求：\n"
    "1) 每个图片的值是一行摘要（纯文本字符串），覆盖该图片中检测到的所有相关对象。\n"
    "2) 相同对象必须合并计数，使用“对象描述×N”（×为全角乘号）；各条目之间仅用斜杠'/'分隔，并按“自上到下、再从左到右”的出现顺序。\n"
    '3) 对象描述沿用密集标注的层级规范：类型/属性[,属性]/[条件属性]；必要时在末尾追加"备注:..."。\n'
    "4) 将任何逗号替换为斜杠'/'，统一使用斜杠作为唯一分隔符。\n"
    "5) 仅返回 JSON；不得包含示例或解释。\n\n"
    "先验规则：\n" + PRIOR_RULES + "\n"
    "【严格禁止】\n"
    "- 禁止任何坐标数字（整数数组）\n"
    "- 禁止几何字段名（bbox_2d、quad、line）\n"
    "- 禁止方括号[]包裹的数字列表\n"
    "- 禁止任何特殊标记或尖括号<>\n"
    "- 仅输出纯文本摘要，不得包含任何结构化几何信息\n"
    "- 有可能会混杂完全不相关的内容，如施工图纸、杂物等，若图片无关或目标不可见：必须输出“无关图片”"
)


USER_PROMPT = (
    '基于所给图片，检测并列出所有对象：按图片分组、按"自上到下再从左到右"排序，'
    "坐标使用 norm1000 整数网格，严格按规范返回 JSON。"
)

USER_PROMPT_SUMMARY = (
    "基于所给图片，为每张图片生成一行中文摘要；相同对象合并为“对象描述×N”（×为全角乘号）。"
    "对象描述沿用密集标注的类型/属性/条件属性层级，必要时在末尾追加“备注:...”。仅输出 JSON，不要坐标或几何信息。"
)


__all__ = [
    "SYSTEM_PROMPT",
    "SYSTEM_PROMPT_SUMMARY",
    "USER_PROMPT",
    "USER_PROMPT_SUMMARY",
]
