# BBU / RRU 业务知识与数据结构速查（Quick Index）

Status: Active
Scope: BBU/RRU domain taxonomy, attributes, and schema conventions for prompts and Stage-A/B rules.
Owners: Data Pipeline + Runtime
Last updated: 2026-01-02
Related: [DATA_JSONL_CONTRACT.md](DATA_JSONL_CONTRACT.md), [reference/PROMPTS_REFERENCE.md](../reference/PROMPTS_REFERENCE.md), [reference/stage-B-knowledge-Chinese.md](../reference/stage-B-knowledge-Chinese.md)

本文面向**数据生产 / Prompt 设计 / Stage-A/B 规则**等场景，基于数据集样本中出现的字段与标签，抽取可快速索引的**业务背景 + 类别/属性词表 + 结构约定**。

**数据来源（本次归纳的直接证据）**：
- BBU：`data_new_schema/bbu_full_1024_poly_new_schema/all_samples.jsonl`（2745 张图，31333 个 objects；全部样本含 `summary`）
- RRU：`data_new_schema/rru_full_1024_poly_new_schema/all_samples.jsonl`（1502 张图，4398 个 objects；全部样本含 `summary`）

> 更通用的“全局 JSONL 合约”见：[docs/data/DATA_JSONL_CONTRACT.md](DATA_JSONL_CONTRACT.md)；本文只补齐 BBU/RRU 的业务语义与索引视角。

---

## Table of Contents
- [1. 业务背景](#background)
- [2. Dense Caption vs Summary](#dense-vs-summary)
- [3. BBU：类别/几何/属性索引](#bbu-index)
- [4. RRU：类别/几何/属性索引](#rru-index)
- [5. 标签（OCR 文本）常见模式](#label-ocr)
- [6. 实务建议](#practice-notes)

---

<a id="background"></a>
## 1. 业务背景（这两套数据在做什么）

### 1.1 BBU：机房/机柜内安装质检（BaseBand Unit）

BBU 数据主要覆盖**机柜内部**设备安装与走线质检。样本中常见检查点包括：
- **设备识别**：BBU 设备品牌（华为/中兴/爱立信）与可见性（完整/部分）。
- **挡风板（气流/防护板）**：是否需要安装（免装/空间充足需安装）与安装方向（方向正确/错误）。
- **固定与接地**：BBU 安装螺丝、机柜处/地排处接地螺丝是否到位（以及可见性）。
- **传输链路**：BBU/ODF 端光纤插头、光纤本体的保护与弯曲半径。
- **工艺**：电线捆扎是否整齐、线缆/端口标签是否可读。

### 1.2 RRU：现场/弱电井/抱杆安装质检（Remote Radio Unit）

RRU 数据主要覆盖**RRU 侧设备与线缆**质检，常见检查点包括：
- **设备存在**：RRU 设备本体。
- **站点距离**：以数字形式落在 `站点距离=<int>`。
- **紧固件**：安装状态（合格/不合格）。
- **接地**：RRU 接地端/地排接地端螺丝安装状态；接地线是否有标签。
- **尾纤**：是否有标签、是否有套管保护。
- **“标签 ↔ 线缆”配对**：用 `组=<id>` 将标签与尾纤/接地线关联（RRU 特有）。

补充：RRU 样本的 `images/...` 路径中可见 `审核通过/审核不通过` 目录（本数据集中约 1391/111），但**该通过/不通过不是 JSON 字段**；若需要使用该信息，应显式注入到 `metadata` 或在上游保持路径语义一致。

---

<a id="dense-vs-summary"></a>
## 2. Dense Caption vs Summary：两种“训练/产线”目标结构

两种模式的核心差异：
- **Dense caption**：目标是逐对象枚举（`objects[]`），每个对象用 `desc` 给出结构化属性。
- **Summary**：目标是单行汇总（`summary`），把对象统计聚合到一个 JSON-string 中。

### 2.1 Dense caption（objects）结构

每条 record 的关键字段：
- `images: list[str]`
- `objects: list[object]`
- `width: int`, `height: int`
- `summary: str`（BBU/RRU 必带；其他域可选）

每个 object：
- 几何字段三选一：`bbox_2d` / `poly` / `line`
- `desc: str`：逗号分隔的 `key=value`（**无空格**），且 `类别` 永远第一个

示例（截断）：
```json
{
  "images": ["images/...jpeg"],
  "objects": [
    {"poly": [...], "desc": "类别=BBU设备,品牌=华为,可见性=完整,挡风板需求=免装"},
    {"line": [...], "desc": "类别=光纤,保护措施=有保护,弯曲半径=半径合理"},
    {"poly": [...], "desc": "类别=标签,文本=5G-BBU-接地线"}
  ],
  "summary": "{...单行 JSON 字符串...}",
  "width": 864,
  "height": 1152
}
```

### 2.2 Summary（summary）结构

`summary` 是**单行 JSON 字符串**（注意：不是 dict），解析后通常包含：
- `统计`: list（按 `类别` 聚合，附带属性分布）
- BBU 可选：`备注`: list[str]（仅在非空时出现）
- RRU 可选：`分组统计`: dict（仅在存在分组时出现）

RRU summary 示例（截断）：
```json
"{\"统计\":[{\"类别\":\"尾纤\",\"套管保护\":{\"有套管\":1},\"标签\":{\"有标签\":1},\"组\":{\"1\":1}},...],\"分组统计\":{\"1\":2}}"
```

---

<a id="bbu-index"></a>
## 3. BBU：类别/几何/属性索引

> 统计与取值来自 `data_new_schema/bbu_full_1024_poly_new_schema/all_samples.jsonl`；若后续 taxonomy 扩展，请以实际导出的 `all_samples.jsonl` 为准重新生成。

### 3.1 类别总览（10 类）

| 类别 | 几何（常见） | 关键属性 keys（出现过） | 说明（业务语义） |
|---|---|---|---|
| `BBU设备` | `poly`（为主） | `品牌`, `可见性`, `挡风板需求`, `备注`(可选) | 机柜内 BBU 本体，记录品牌与是否拍全 |
| `挡风板` | `poly`（为主） | `品牌`, `可见性`, `安装方向`, `备注`(可选) | 挡风板/气流板；关注安装方向与是否需要 |
| `BBU安装螺丝` | `bbox_2d`（为主） | `可见性`, `符合性`, `备注`(极少) | 固定螺丝是否可见/符合 |
| `机柜处接地螺丝` | `bbox_2d` | `可见性`, `符合性` | 机柜接地点螺丝 |
| `地排处接地螺丝` | `bbox_2d` | `可见性`, `符合性`, `备注`(极少) | 地排接地点螺丝 |
| `BBU端光纤插头` | `bbox_2d`/`poly` | `可见性`, `符合性`, `备注`(极少) | BBU 侧光纤插头 |
| `ODF端光纤插头` | `poly`/`bbox_2d` | `可见性`, `符合性` | ODF 侧光纤插头 |
| `光纤` | `line` | `保护措施`, `弯曲半径`, `备注`(可选) | 光纤本体（线），关注保护与弯曲半径 |
| `电线` | `line` | `捆扎` | 电源/地线等走线工艺（整齐/散乱） |
| `标签` | `poly` | `文本` 或 `可读性` | 标签 OCR：可读→`文本`；不可读→`可读性=不可读` |

### 3.2 关键属性取值（来自样本分布）

- `品牌`（BBU设备）：`华为` / `中兴` / `爱立信`
- `挡风板需求`（BBU设备）：`免装` / `空间充足需安装`
- `安装方向`（挡风板）：`方向正确` / `方向错误`（样本中极少见错误）
- `保护措施`（光纤）：`有保护` / `无保护`
- `弯曲半径`（光纤）：`半径合理` / `半径不合理<4cm或成环`
- `捆扎`（电线）：`整齐` / `散乱`（散乱样本极少）

### 3.3 `备注`（BBU 特有）用途与高频内容

`备注` 为自由文本（仅去空格，保留标点），常用于记录“无法判断/局部缺失/未保护”等质检语义。

在本数据集中较高频的备注（对象级）包括：
- `部分未套蛇形管`（光纤保护相关）
- `无法判断品牌`（设备/挡风板品牌拍摄不全或遮挡）
- `无法判断是否足够空间安装挡风板`（挡风板需求不确定）

---

<a id="rru-index"></a>
## 4. RRU：类别/几何/属性索引

> 统计与取值来自 `data_new_schema/rru_full_1024_poly_new_schema/all_samples.jsonl`。

### 4.1 类别总览（8 类）

| 类别 | 几何（常见） | 关键属性 keys（出现过） | 说明（业务语义） |
|---|---|---|---|
| `RRU设备` | `poly` | （无） | RRU 本体 |
| `站点距离` | `bbox_2d` | `站点距离`（数字字符串），`组`(极少) | 距离信息（通常为 OCR 数字） |
| `紧固件` | `poly` | `安装状态` | 紧固/抱箍/支架等安装状态 |
| `RRU接地端` | `bbox_2d` | `安装状态` | RRU 接地点安装状态 |
| `地排接地端螺丝` | `bbox_2d` | `安装状态` | 地排侧接地端螺丝 |
| `尾纤` | `line` | `标签`, `套管保护`, `组`(可选) | 传输尾纤；关注套管保护与标签 |
| `接地线` | `line` | `标签`, `组`(可选) | 接地线；关注是否有标签 |
| `标签` | `poly` | `文本` 或 `可读性`，`组`(可选) | 标签 OCR + 与线缆配对 |

### 4.2 `组=<id>`：RRU 的“标签 ↔ 线缆”配对规则

RRU 中存在“同一张图里多根线 + 多个标签”的情况。为避免仅凭空间关系产生歧义，数据使用 `desc` 内的 `组=<id>` 表达配对关系：
- **出现位置**：`尾纤` / `接地线` / `标签`（样本中主要如此；`站点距离` 极少出现组）
- **业务含义**：同一 `组` 的对象视为“一条线缆及其对应标签”（或“接地线及其对应标签”）
- **统计事实（本数据集）**：
  - 分组样本约 429 张（对应 summary 中出现 `分组统计`）
  - 每个分组几乎总是恰好 2 个对象（典型为 `尾纤`+`标签` 或 `接地线`+`标签`）
  - 单图中常见 1 组或 2 组（组号通常为 `1`、`2`）

### 4.3 关键属性取值（来自样本分布）

- `安装状态`（紧固件）：`合格` / `不合格`（不合格样本极少）
- `安装状态`（RRU接地端 / 地排接地端螺丝）：样本中均为 `合格`
- `标签`（尾纤/接地线）：样本中均为 `有标签`（合约允许扩展到 `无标签`）
- `套管保护`（尾纤）：`有套管` / `无套管`
- `站点距离`：数字字符串（样本中范围约 1～3223，离散值较多）

---

<a id="label-ocr"></a>
## 5. 标签（OCR 文本）常见模式：用于 Prompt/规则快速定位

### 5.1 BBU 标签文本高频片段（示例）

BBU 数据中的 `标签,文本=...` 既可能指向 BBU 本身，也常用于标注“去往 RRU/AAU/电源/接地/GPS”的线缆端口：
- 接地相关：`5G-BBU-接地线`、`NR900-BBU-接地线`、`BBU接地线`
- 光纤/尾纤相关：`NR900-RRU1-光纤`、`5G-BBU-传输光纤`、`...尾纤`
- GPS：`5G-GPS信号线`、`NR900-GPS信号线`
- 电源极性：`...（正极）` / `...（负极）`

提示：BBU 场景中出现 `RRU`/`AAU` 并不矛盾——机柜内标签经常以“远端设备/扇区”为命名目标。

### 5.2 RRU 标签文本高频片段（示例）

RRU 的标签文本更集中在“尾纤/接地线/光纤”：
- `5G-RRU-接地线`、`RRU接地线`、`接地线`
- `RRU尾纤`、`5G-RRU-尾纤`、`...RRU1-光纤`

---

<a id="practice-notes"></a>
## 6. 实务建议（面向规则/质检/数据演进）

- **优先以 `类别` 驱动规则**：避免对 `文本` 做硬编码匹配；文本存在大量站点名/扇区号/频段差异。
- **把 `备注` 视为“不确定/特殊情况”通道**：BBU 中大量 “无法判断品牌/未套蛇形管”等属于关键质检语义。
- **RRU 分组务必同时检查 `分组统计` 与对象级 `组`**：`summary` 用于快速判定分组存在；对象级 `组` 决定具体配对。
- **若需要通过/不通过标签**：建议在转换/融合阶段将目录语义写入 `metadata.audit_result`，避免仅靠路径解析。
