# Tasks

- [x] Define the new rollout-server config namespace under `custom.extra.rollout_server` (documented + validated by launcher).
- [x] Update `configs/train/grpo/summary_1024.yaml` to use server-mode rollout (trainer connectivity in `rlhf.*`, server args in `custom.extra.rollout_server`).
- [x] Update `configs/train/grpo/summary_1024_attr_key_recall.yaml` to inherit server-mode rollout cleanly (remove colocate-only overrides; keep reward overrides).
- [x] Keep token budgets aligned in migrated configs:
  - [x] `global_max_length=12000` (total input+output token budget)
  - [x] `custom.extra.rollout_server.vllm_max_model_len=12000` (server-side budget; must be >= global_max_length)
- [x] Implement a unified server-mode launcher (`scripts/grpo_server_mode.sh`) that:
  - [x] Loads YAML with extends (same resolution rules as `src/config/loader.py` / `ConfigLoader.load_yaml_with_extends`)
  - [x] Validates required rollout-server fields (TP/DP/max_model_len) and trainer connectivity fields (`rlhf.vllm_server_host`, `rlhf.vllm_server_port`)
  - [x] Fails fast if the configured rollout port (`rlhf.vllm_server_port[0]`, 8080 in migrated configs) is unavailable
  - [x] Fails fast if `custom.extra.rollout_server.vllm_enable_lora=true` is requested (forbidden in this workflow)
  - [x] Launches `conda run -n ms swift rollout ...` on `CUDA_VISIBLE_DEVICES=<server_gpus>` in the background (server logs redirected to file)
  - [x] Health-checks the configured server endpoint before starting training (default: `http://127.0.0.1:8080/health/`)
  - [x] Launches `scripts/train.sh` on `CUDA_VISIBLE_DEVICES=<train_gpus>` in the foreground (console shows learner logs)
  - [x] Records the rollout server PID/PGID and terminates the server on launcher exit
- [x] Remove the deprecated combined launcher `scripts/grpo_server_train.sh`.
- [x] Remove obsolete split scripts (`scripts/grpo_rollout_server.sh`, `scripts/grpo_train_server_mode.sh`) and update docs to the unified convention.
- [x] Update docs and script inventory to reference the new launch scripts and config fields:
  - [x] `scripts/README.md` (canonical script inventory; add new scripts + removal note)
  - [x] `technical_report.md` (GRPO server-rollout entrypoint references)
  - [x] `docs/training/GRPO_MS_SWIFT_PIPELINE.md` (server-mode config surface + operator notes)
  - [x] `docs/training/TRAINING_PLAYBOOK.md` and/or `docs/training/REFERENCE.md` (runbook)
  - [x] `docs/README.md` (doc index / directory↔doc map; no change needed — `scripts/` already points to `scripts/README.md`)
- [x] Add lightweight validation coverage (unit test or script-level check) for rollout-server config extraction and required-field errors.
- [x] Run `ruff` + `basedpyright` (conda env `ms`) and any relevant smoke checks (ruff check + targeted basedpyright + pytest smoke).
