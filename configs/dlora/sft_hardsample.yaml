extends: ./sft_base.yaml

# Dynamic hard-sample mining (token_acc-based), smoke-tuned paths

model:
  model: output/11-24/stage_1.5_merged/sft_all-checkpoint-2070

training:
  output_dir: ./output/debug
  logging_dir: ./tb/debug
  run_name: hsm_dynamic_debug
  per_device_train_batch_size: 1
  per_device_eval_batch_size: 1
  learning_rate: 2e-5
  vit_lr: 1e-5
  aligner_lr: 5.0e-5
  num_train_epochs: 5

custom:
  train_jsonl: data/bbu_full_768_poly-need_review/train_tiny.jsonl
  val_jsonl: data/bbu_full_768_poly-need_review/val_tiny.jsonl
  hard_sample_mining:
    enabled: true
    start_epoch: 0
    hard_pool_frac: 0.3
    activate_after_pct: 0.7   # start mining after 70% of epochs
    ema_decay: 0.9
    source_ratio: 0.08        # append sources equal to 8% of target length
    log_pool_metrics: true
    log_prefix: hsm
